var _t=Object.defineProperty,wt=Object.defineProperties;var Pt=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var Ot=Object.prototype.hasOwnProperty,Mt=Object.prototype.propertyIsEnumerable;var V=(v,i,m)=>i in v?_t(v,i,{enumerable:!0,configurable:!0,writable:!0,value:m}):v[i]=m,L=(v,i)=>{for(var m in i||(i={}))Ot.call(i,m)&&V(v,m,i[m]);if(tt)for(var m of tt(i))Mt.call(i,m)&&V(v,m,i[m]);return v},et=(v,i)=>wt(v,Pt(i));var z=(v,i,m)=>(V(v,typeof i!="symbol"?i+"":i,m),m);(function(){"use strict";const v=[];for(let t=0;t<256;++t)v.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);function i(t){try{const{pathname:e,search:n}=new URL(t);return`${e}${n}`}catch(e){return t}}function m(t,e){const n=i(t.attr("href")),a=t.text().trim();return{path:n,name:e?e(a):a}}function K(t){t=t.trim().toLowerCase().replace(".","");const e=parseFloat(t);if(Number.isNaN(e))return null;switch(t[t.length-1]){case"k":return e*1e3;case"m":return e*1e6;case"g":return e*1e9;default:return e}}function $(t,e){return t=t.trim().toLowerCase(),t.endsWith("giây trước")?e-parseInt(t)*1e3:t.endsWith("phút trước")?e-parseInt(t)*1e3*60:t.endsWith("giờ trước")?e-parseInt(t)*1e3*60*60:t.endsWith("ngày trước")?e-parseInt(t)*1e3*60*60*24:t.endsWith("tháng trước")?e-parseInt(t)*1e3*60*60*24*30:t.endsWith("năm trước")?e-parseInt(t)*1e3*60*60*24*365:new Date(t.replace(/^(\d{1,2}):(\d{1,2}) (\d{1,2})\/(\d{1,2})(\/\d{2,4})?$/,(n,a,r,o,c,s)=>{var d;return`${a}:${r}:00 ${c}/${o}/${(d=s==null?void 0:s.slice(1))!=null?d:new Date(e).getFullYear()}`})).getTime()||new Date(t.replace(/^(\d{1,2})\/(\d{1,2})\/(\d{1,})$/,"$2/$1/$3")).getTime()}const nt=/^Chương|Chapter|Chap\.?\s+/i;function S(t){return t.replace(nt,"").trim()}function Y(t,e=!1){const{pathname:n,search:a}=new URL(t,"http://localhost");return(!n||n==="/"||n==="/index"||n==="/index.html")&&(!e||!a)}function at(t){return Object.assign(self,{__DEFINE_API__:t}),t}function rt(t){return Object.assign(self,{__DEFINE_PACKAGE__:t}),t}const _="https://www.nettruyenus.com";function B(t,e){return AppInfo.extension?`${t}#nettruyen_extra`:`https://proxy.mangaraiku.eu.org/?url=${encodeURIComponent(t.slice(t.indexOf(".")+1).split("/",1)[0]==="googleusercontent.com"?t:`https://images2-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&gadget=a&no_expand=1&resize_h=0&rewriteMime=image%2F*&url=${encodeURIComponent(t)}`)}&headers=${encodeURIComponent(JSON.stringify(e))}`}const x=rt({id:"nettruyen",name:"Net Truyen",favicon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAKpUExURa+WENi3ANKxAdOyAdS0BM+tALaqZv7////++LanVdKvANOzBNGxAdm4AK+VBM2yDf/iAf3bA//cA/7bBP/jANGzDNjY2/////n8/8a1Uv/cAP7cBv3aA//jA9CzAsqqEf/XBfrPB/vRBvzSCvfNAL2vavv9/8SwUv7RAPrRCvnPBv/YB82qBcqoFP/UCfrNC/zOC//VCtKvDtnY1MOtUP/OAPvODv/VC82oCcmlF//QDvnJD/rKD/vLEPvLE/fFAMCtZvj+/8SsUP7KAfnKEvjID//QEMylDMihG//LEvfEFPjFFPnGFPTCEvfFFP/LE9SqEdLV4cqxXPvEBPjFF//MFMuhEMeeH/7GGPXAGf/HGbOOGd+vGP3GHfa8B7mpdMCpYvvACfbBHP/HGsmdFMWaIvzBHfO7HvO7IP2/FLSYTLeaSfy+FfzBHs6iJp6AL//DGvO6H/O6Hv3CH8iZGcSWJvu8I/K2JPK3Jva1FsmqXr+7sOOnFPi8J/C0ItSfHPa5JPO2I/K2I/u9JcaVHcOSKvm3KPCxKfGyK/WxHsWhVeXt/8KbRfi0Ifa2KvGxKfKyKfCxKPq4KsWRIcGPLveyLe6tLu+uMPStI76aVf3//8e8pt+dHvSxMe6sLfCuLvCuLfizL8SOJcCMMfauMu2oMu6pNPKoKL6ZWvz//+3w9r6TSPWrLO2pM++pMu6pMu2oMfavM8KKKb+JNvOpN+qkN+umOu+jLr6ZYPf7/7+zoN2VJvCqPOulN+ylN/SrOcGHLsCEL/qoNPGiM/GjNfahKb2UXPf9/+jt87mJRPikLvKjM/qoNcaFKq2JWsKSUr+RU8CSVb6MSraefv79+8W6q7iISMGTVb6QU8OTU6iDUPX5/u/1/fD2/fj6/v///vz9/vD1/fP3/cP3IHIAAAABYktHRBcL1piPAAAAB3RJTUUH5wkSBwYgWO7tNAAAARtJREFUGNMBEAHv/gAAAQIDBAUGBwgHCQoLDA0OAA8QERITFBUWFxgZGhscHR4AHyAhIiIjJCUHJicoKSorLAAtLi8wMC8xMjMXNDU2Lzc4ADk6Ozw8PT4/QEFCQ0RFRkcASElKS0xNTk9QUVJTVEpVVgBXWFlZWltcXV5fYGFiWWNkAGVmZ2hpamtsbW5vcHFyc3QAdXZ3eHl6e3x9fn+AgYKDhACFhoeIiYqLjI2Ijo+QkZKTAJSVlpeYmZqbnJ2en6CeoaIAo6SlpqeoqaqrrK2ur7CxsgCztLW2t7i5F7q7vL2+tb/AAMHCw8TFxscXyMnKxMvDzM0Azs/Q0dLTB9QX1dbX0NjZ2gDb3N3d3N4XF9/g3d3d3eHinyRwGnuYBAsAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDktMThUMDc6MDY6MzIrMDA6MDB2b2K2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA5LTE4VDA3OjA2OjMyKzAwOjAwBzLaCgAAACh0RVh0ZGF0ZTp0aW1lc3RhbXAAMjAyMy0wOS0xOFQwNzowNjozMiswMDowMFAn+9UAAAAASUVORK5CYII=",version:"0.0.22",description:"Plugin nguồn Net Truyen",author:"Tachibana Shin <tachibshin@duck.com>",homepage:"https://github.com/manga-raiku/raiku-plugin-nettruyen",isNSFW:!1,language:"vi",support:!0,updatedAt:1698510835110});function W(t){return Object.fromEntries(new URLSearchParams(t.slice((t.indexOf("?")>>>0)+1)).entries())}function X(t){const e=t.indexOf("/tim-truyen/")+12;return t.slice(e,t.indexOf("?",e)>>>0).replace(/\/$/,"").replace(/\/$/,"_")}function U(t){var e,n,a;return(a=(n=(e=t.attr("data-src"))!=null?e:t.attr("data-original"))!=null?n:t.attr("data-cdn"))!=null?a:t.attr("src")}function q(t){const e=t.indexOf("/truyen-tranh/")+14;return t.slice(e,t.indexOf("?",e)>>>0).replace(/\/$/,"").replace(/\/$/,"_")}function G(t){const e=t.indexOf("/truyen-tranh/")+14,n=t.slice(e,t.indexOf("/",e)),a=t.slice(e+n.length+1,t.indexOf("/",t.indexOf("/",e+n.length+1)+1)>>>0).replace(/^chap-/i,"").replace(/\//g,"-i");return{comic:n,chap:a}}function E(t,e,n){return t(e.toArray().find(a=>!!t(a).text().trim().startsWith(n))).text().trim().slice(n.length).trim()}function j(t,e,n){const a=U(e.find("img")),r={name:"comic",params:{sourceId:x.id,comic:q(i(e.find("a").attr("href")))}},o=e.find("h3").text().trim(),c=e.find(".message_main p"),s=E(t,c,"Tên khác:"),d=E(t,c,"Thể loại:").split(",").map(p=>p.trim()).filter(Boolean),l=E(t,c,"Tình trạng:"),h=E(t,c,"Tác giả:"),A=e.find(".box_text").text(),I=e.find("h3 + a, .chapter a").toArray().map(p=>{const w=t(p),N=m(w),O=w.next(),D={name:"comic chap",params:L({sourceId:x.id},G(N.path))};return{id:parseInt(w.attr("href").match(/(\d+)\/?$/)[1])+"",route:D,name:S(N.name),updated_at:O.is(".time")&&O.text()?$(O.text(),n):null,views:null}}),[g,f,u]=e.find(".pull-left").text().trim().split(" ").filter(Boolean).map(p=>K(p)),y=t(".icon.icon-hot").length>0?"Hot":null;return{image:a,route:r,name:o,othername:s,tags:d,status:l,author:h,description:A,last_chapters:I,views:g,comments:f,likes:u,label:y}}function J(t,e){var g;const n=parseDom(t),a=n("#ctl00_mainContent_ctl00_divBasicFilter > h1 > strong").text().trim(),r=n("#ctl00_mainContent_ctl00_divDescription").text(),o={type:"Thể loại",select:n("#ctl00_divRight > div > div > ul > li > a").toArray().map(f=>{const u=n(f),y=i(u.attr("href")),p={name:"genre",params:{sourceId:x.id,type:X(y)},query:W(y)},w=u.text();return{route:p,name:w}})},c={type:"Trạng thái",key:"status",items:n("#ctl00_mainContent_ctl00_ulStatus a").toArray().map(f=>{const{name:u,path:y}=m(n(f)),p=new URL(y,"http://localhost").searchParams.get("status");return{name:u,value:p}})},s={type:"Sắp xếp",key:"sort",items:n("#ctl00_mainContent_ctl00_divSort a").toArray().map(f=>{const{name:u,path:y}=m(n(f)),p=new URL(y,"http://localhost").searchParams.get("sort");return{name:u,value:p}})},d=[o,c,s],l=n("#ctl00_divCenter > div.Module.Module-170 .item, .items .item").toArray().map(f=>j(n,n(f),e)),h=parseInt(n("#ctl00_mainContent_ctl01_divPager .active").text().trim()),A=Number.isNaN(h)?1:h,I=h?parseInt((g=new URL(n("#ctl00_mainContent_ctl01_divPager a").last().attr("href"),"http://localhost").searchParams.get("page"))!=null?g:"1"):1;return{name:a,description:r,filters:d,items:l,curPage:A,maxPage:I}}async function Q(t,e,n){t.endsWith("/")&&(t=t.slice(0,-1));const a=new URL(t,"http://localhost");a.searchParams.set("page",e+"");for(const o in n)a.searchParams.set(o,n[o]+"");const{data:r}=await get({url:`${_}/${a.pathname}?${a.searchParams+""}`,method:void 0,cache:void 0,integrity:void 0,keepalive:void 0,redirect:void 0,referrerPolicy:void 0,window:void 0});return J(r,Date.now())}async function ct(t){const{data:e}=await get({url:`${_}/Comic/Services/ComicService.asmx/ProcessChapterList?comicId=${t}`});return JSON.parse(e).chapters.map(n=>{const a={name:"comic chap",params:L({sourceId:x.id},G(i(n.url)))};return{id:n.chapterId+"",name:S(n.name),route:a,updated_at:null,views:null}})}function ot(t,e){const n=parseDom(t),a=n("#ctl00_divAlt1 .item").toArray().map(c=>j(n,n(c),e)),r=n("#ctl00_divCenter .item").toArray().map(c=>j(n,n(c),e)),o=n("#topMonth li").toArray().map(c=>{const s=n(c),d=U(s.find("img")),l={name:"comic",params:{sourceId:x.id,comic:i(s.find("a").attr("href"))}},h=s.find("h3").text().trim(),{path:A,name:I}=m(s.find(".chapter a")),g={route:{name:"comic chap",params:L({sourceId:x.id},G(A))},name:S(I),updated_at:K(s.find(".chapter .view").text().trim())};return{image:d,route:l,name:h,last_chapter:g}});return{recommend:a,last_update:r,top:o}}async function st(){const[t,e]=await Promise.all([get({url:_}).then(n=>ot(n.data,Date.now())),get({url:`${_}/tim-truyen?status=-1&sort=13`}).then(n=>J(n.data,Date.now()))]);return{sliders:e.items.slice(0,7),hot:e.items.slice(7),last_update:t.last_update}}function it(t){const e=parseDom(t);return e("li").toArray().map(n=>{const a=e(n),r={name:"comic",params:{sourceId:x.id,comic:q(i(a.find("a").attr("href")))}},o=a.find("h3").text().trim(),c=U(a.find("img")),s=a.find("h4 i"),d=S(s.first().text()),l=s.length>2?s.eq(1).text().trim():"",h=s.last().text().split(",").map(A=>A.trim()).filter(Boolean);return{route:r,name:o,image:c,last_chapter:d,othername:l,tags:h}})}async function mt(t,e){const{data:n}=await get({url:`${_}/Comic/Services/SuggestSearch.ashx?q=${encodeURIComponent(t)}&page=${e}`});return it(n)}async function dt(t,e){const{data:n}=await get({url:`${_}/tim-truyen?keyword=${encodeURIComponent(t)}&page=${e}`});return J(n,Date.now())}function H(t,e,n){var A,I;const a=parseInt(e.attr("id").match(/\d+/)[0]),r=(I=(A=e.find(".member > .progress-bar").attr("style"))==null?void 0:A.match(/width:\s*(\d+)/))==null?void 0:I[1],o={avatar:U(e.find(".avatar img")),name:e.find(".authorname").text().trim(),level:{current:parseInt(e.find(".member > span:eq(0)").attr("data-level")),perNext:r?parseFloat(r):null},chapter:S(e.find(".cmchapter").text().trim())};e.find(".comment-content img").each((g,f)=>{const u=t(f);u.attr("src",U(u))});const c=e.find(".comment-content").html(),s=parseInt(e.find(".vote-up-count").text()),d=parseInt(e.find(".vote-down-count").text()),l=$(e.find("abbr:eq(0)").text(),n),h=e.find(".item.child").toArray().map(g=>H(t,e.find(g),n));return{id:a,author:o,content:c,like:s,dislike:d,created_at:l,repiles:h}}function ut(t,e){var D,k,R,F;const n=parseDom(t),a=n("#item-detail"),r=a.find("h1").text().trim(),o=parseInt((k=(D=t.match(/gOpts\.comicId=(\d+)/))==null?void 0:D[1])!=null?k:""),c=$(a.find("time").text().trim().slice(16,-1),e),s=U(n("#item-detail > div.detail-info > div > div.col-xs-4.col-image > img")),d=a.find(".othername p:not(.name)").text().trim(),l=a.find(".author p:not(.name)").find("a").toArray().map(P=>{const{name:C,path:M}=m(n(P)),T={name:"author",params:{sourceId:x.id,type:""},query:W(M)};return{name:C,route:T}}),h=a.find(".status p:not(.name)").text().trim(),A=a.find(".kind p:not(.name)").find("a").toArray().map(P=>{const{name:C,path:M}=m(n(P)),T={name:"genre",params:{sourceId:x.id,type:X(M)},query:W(M)};return{name:C,route:T}}),I=K(a.find(".kind").next().find("p:not(.name)").text().replace(/\./g,"")),g=a.find("span[itemprop=aggregateRating]"),f={cur:parseFloat(g.find("[itemprop=ratingValue]").text()),max:parseFloat(g.find("[itemprop=bestRating]").text()),count:parseInt(g.find("[itemprop=ratingCount]").text())},u=K(n(".follow b").text()),y=n(".detail-content p").text(),p=n("#nt_listchapter .chapter").toArray().map(P=>{const C=n(P),{path:M,name:T}=m(C.find("a")),yt={name:"comic chap",params:L({sourceId:x.id},G(M))},xt=parseInt(C.find("a").attr("data-id"))+"",It=$(C.next().text(),e)||null,Ct=K(C.next().next().text().trim());return{id:xt,route:yt,name:S(T),updated_at:It,views:Ct}}),w=n("#nt_comments .comment-list .item").toArray().map(P=>H(n,n(P),e)),N=parseInt(n(".comment-count").text()),O=parseInt((F=(R=n("#ctl00_mainContent_divPager > ul > li:nth-child(14) > a").last().attr("href"))==null?void 0:R.slice(1))!=null?F:"1")||1;return{name:r,othername:d,manga_id:o+"",updated_at:c,image:s,author:l,status:h,genres:A,views:I,likes:null,rate:f,follows:u,description:y,chapters:p,comments:w,comments_count:N,comments_pages:O}}async function pt(t){const{data:e,url:n}=await get({url:`${_}/truyen-tranh/${t}`});if(Y(n))throw new Error("not_found");return ut(e,Date.now())}function lt(t,e){var u,y,p,w,N,O,D,k;const n=parseDom(t),a=n("#ctl00_Head1 > meta:nth-child(12)").attr("content"),r=n("h1").text().split("-").slice(0,-1).join("-").trim(),o={name:"comic",params:{sourceId:x.id,comic:q(m(n("#ctl00_divCenter > div > div:nth-child(1) > div.top > h1 > a")).path)}},c=parseInt((y=(u=t.match(/gOpts\.comicId=(\d+)/))==null?void 0:u[1])!=null?y:"")+"",s=parseInt((w=(p=t.match(/gOpts\.chapterId=(\d+)/))==null?void 0:p[1])!=null?w:"")+"",d=(N=t.match(/gOpts\.cdn="([^"]+)"/))==null?void 0:N[1],l=(O=t.match(/gOpts\.cdn2="([^"]+)"/))==null?void 0:O[1],h=$(n("#ctl00_divCenter > div > div:nth-child(1) > div.top > i").text().trim().slice(16,-1),e),A=n(".reading-detail img").toArray().map(R=>{const F=n(R),P=F.attr("src"),C=F.attr("data-original"),M=F.attr("data-cdn");return{src:P.includes("/logos/logo-nettruyen.png")?C:P,original:C,cdn:M}}),I=n("#nt_comments .comment-list .item").toArray().map(R=>H(n,n(R),e)),g=parseInt(n(".comment-count").text()),f=parseInt((k=(D=n("#ctl00_mainContent_divPager > ul > li:nth-child(14) > a").last().attr("href"))==null?void 0:D.slice(1))!=null?k:"1")||1;return{name:r,image:a,manga_id:c,path_manga:o,ep_id:s,updated_at:h,pages:A,cdn:d,cdn2:l,comments:I,comments_count:g,comments_pages:f}}async function ht(t,e){const{data:n,url:a}=await get({url:`${_}/truyen-tranh/${t}`});if(Y(a))throw new Error("not_found");const r=await lt(n,Date.now());if(!e){const{data:o}=await get({url:`${_}/Comic/Services/ComicService.asmx/ProcessChapterList?comicId=${r.manga_id}`});return et(L({},r),{chapters:JSON.parse(o).chapters.map(c=>{const s={name:"comic chap",params:L({sourceId:x.id},G(c.url))};return{id:c.chapterId+"",name:S(c.name),route:s,updated_at:null,views:null}})})}return r}function gt(t,e){const n=parseDom(t);return n(".item").toArray().map(a=>H(n,n(a),e))}async function ft(t,e,n=-1,a=0,r,o){const{data:c}=await get({url:`https://www.nettruyenmax.com/Comic/Services/CommentService.asmx/List?comicId=${t}&orderBy=${e?5:0}&chapterId=${n}&parentId=${a}&pageNumber=${r}&token=${o}`}),{commentCount:s,pager:d,response:l}=JSON.parse(c);return{comments_count:parseInt(s),comments_pages:parseInt(d.slice(d.indexOf('a href="#')>>>0,2)),comments:await gt(l,Date.now())}}const Z=[{value:"ngay",match:"/tim-truyen?status=-1&sort=13",name:{"vi-VN":"Ngày","en-US":"Date"}},{value:"tuan",match:"/tim-truyen?status=-1&sort=12",name:{"vi-VN":"Tuần","en-US":"Week"}},{value:"thang",match:"/tim-truyen?status=-1&sort=11",name:{"vi-VN":"Tháng","en-US":"Month"}}],b={referer:"https://www.nettruyenmax.com"},At=[{name:"Server 1",has:()=>!0,parse:({pages:t})=>t.map(e=>B(e.src,b))},{name:"Server 2",has:({pages:t})=>t[0].original!==null&&t[0].original!==t[0].src,parse({pages:t}){return t.map(e=>{var n;return((n=e.original)==null?void 0:n.indexOf("focus-opensocial.googleusercontent"))!==-1?B(decodeURIComponent(e.original.split("&url",2)[1]),b):B(`https://images2-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&gadget=a&no_expand=1&resize_h=0&rewriteMime=image%2F*&url=${encodeURIComponent(e.original)}`,b)})}},{name:"Server 3",has:t=>t.cdn!==null,parse:({pages:t})=>t.map(e=>B(e.cdn,b))},{name:"Server 4",has:({pages:t,cdn:e,cdn2:n})=>t[0].cdn!==null&&!!e&&!!n,parse:({pages:t,cdn:e,cdn2:n})=>t.map(a=>B(a.cdn.replace(e,n),b))}];class vt{constructor(){z(this,"Rankings",Z);z(this,"Servers",At)}async setup(){AppInfo.extension&&(console.log("Plugin run mode extension."),await setReferrers({"#nettruyen":_}))}async index(){return st()}async getComic(e){return pt(e)}async getComicChapter(e,n,a){const r=n.lastIndexOf("-i")>>>0;return ht(e.replace(/-\d+$/,"")+"/chap-"+n.slice(0,r)+"/"+n.slice(r+2),a)}async getComicComments(e,n,a=-1,r=0,o,c){return ft(e,n,a,r,o,c)}async getListChapters(e){return ct(e)}async searchQuickly(e,n){return mt(e,n)}async search(e,n){return dt(e,n)}async getRanking(e,n,a){var o;const r=(o=Z.find(c=>c.value===e))==null?void 0:o.match;if(!r)throw new Error("not_found");return Q(r,n,a)}async getCategory(e,n,a){return Q(`/tim-truyen/${e}`,n,a)}}at(vt)})();
