var _t=Object.defineProperty,wt=Object.defineProperties;var Pt=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var Ot=Object.prototype.hasOwnProperty,Mt=Object.prototype.propertyIsEnumerable;var z=(v,i,m)=>i in v?_t(v,i,{enumerable:!0,configurable:!0,writable:!0,value:m}):v[i]=m,L=(v,i)=>{for(var m in i||(i={}))Ot.call(i,m)&&z(v,m,i[m]);if(tt)for(var m of tt(i))Mt.call(i,m)&&z(v,m,i[m]);return v},et=(v,i)=>wt(v,Pt(i));var E=(v,i,m)=>(z(v,typeof i!="symbol"?i+"":i,m),m);(function(){"use strict";const v=[];for(let t=0;t<256;++t)v.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);function i(t){try{const{pathname:e,search:n}=new URL(t);return`${e}${n}`}catch(e){return t}}function m(t,e){const n=i(t.attr("href")),a=t.text().trim();return{path:n,name:e?e(a):a}}function K(t){t=t.trim().toLowerCase().replace(".","");const e=parseFloat(t);if(Number.isNaN(e))return null;switch(t[t.length-1]){case"k":return e*1e3;case"m":return e*1e6;case"g":return e*1e9;default:return e}}function $(t,e){return t=t.trim().toLowerCase(),t.endsWith("giây trước")?e-parseInt(t)*1e3:t.endsWith("phút trước")?e-parseInt(t)*1e3*60:t.endsWith("giờ trước")?e-parseInt(t)*1e3*60*60:t.endsWith("ngày trước")?e-parseInt(t)*1e3*60*60*24:t.endsWith("tháng trước")?e-parseInt(t)*1e3*60*60*24*30:t.endsWith("năm trước")?e-parseInt(t)*1e3*60*60*24*365:new Date(t.replace(/^(\d{1,2}):(\d{1,2}) (\d{1,2})\/(\d{1,2})(\/\d{2,4})?$/,(n,a,r,o,c,s)=>{var d;return`${a}:${r}:00 ${c}/${o}/${(d=s==null?void 0:s.slice(1))!=null?d:new Date(e).getFullYear()}`})).getTime()||new Date(t.replace(/^(\d{1,2})\/(\d{1,2})\/(\d{1,})$/,"$2/$1/$3")).getTime()}const nt=/^Chương|Chapter|Chap\.?\s+/i;function S(t){return t.replace(nt,"").trim()}function Y(t){const{pathname:e}=new URL(t,"http://localhost");return!e||e==="/"||e==="/index"||e==="/index.html"}function at(t){return Object.assign(self,{__DEFINE_API__:t}),t}function rt(t){return Object.assign(self,{__DEFINE_PACKAGE__:t}),t}function B(t,e){return`https://proxy.mangaraiku.eu.org/?url=${encodeURIComponent(t.slice(t.indexOf(".")+1).split("/",1)[0]==="googleusercontent.com"?t:`https://images2-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&gadget=a&no_expand=1&resize_h=0&rewriteMime=image%2F*&url=${encodeURIComponent(t)}`)}&headers=${encodeURIComponent(JSON.stringify(e))}`}const P="https://www.nettruyenus.com/",x=rt({id:"nettruyen",name:"Net Truyen",favicon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAKpUExURa+WENi3ANKxAdOyAdS0BM+tALaqZv7////++LanVdKvANOzBNGxAdm4AK+VBM2yDf/iAf3bA//cA/7bBP/jANGzDNjY2/////n8/8a1Uv/cAP7cBv3aA//jA9CzAsqqEf/XBfrPB/vRBvzSCvfNAL2vavv9/8SwUv7RAPrRCvnPBv/YB82qBcqoFP/UCfrNC/zOC//VCtKvDtnY1MOtUP/OAPvODv/VC82oCcmlF//QDvnJD/rKD/vLEPvLE/fFAMCtZvj+/8SsUP7KAfnKEvjID//QEMylDMihG//LEvfEFPjFFPnGFPTCEvfFFP/LE9SqEdLV4cqxXPvEBPjFF//MFMuhEMeeH/7GGPXAGf/HGbOOGd+vGP3GHfa8B7mpdMCpYvvACfbBHP/HGsmdFMWaIvzBHfO7HvO7IP2/FLSYTLeaSfy+FfzBHs6iJp6AL//DGvO6H/O6Hv3CH8iZGcSWJvu8I/K2JPK3Jva1FsmqXr+7sOOnFPi8J/C0ItSfHPa5JPO2I/K2I/u9JcaVHcOSKvm3KPCxKfGyK/WxHsWhVeXt/8KbRfi0Ifa2KvGxKfKyKfCxKPq4KsWRIcGPLveyLe6tLu+uMPStI76aVf3//8e8pt+dHvSxMe6sLfCuLvCuLfizL8SOJcCMMfauMu2oMu6pNPKoKL6ZWvz//+3w9r6TSPWrLO2pM++pMu6pMu2oMfavM8KKKb+JNvOpN+qkN+umOu+jLr6ZYPf7/7+zoN2VJvCqPOulN+ylN/SrOcGHLsCEL/qoNPGiM/GjNfahKb2UXPf9/+jt87mJRPikLvKjM/qoNcaFKq2JWsKSUr+RU8CSVb6MSraefv79+8W6q7iISMGTVb6QU8OTU6iDUPX5/u/1/fD2/fj6/v///vz9/vD1/fP3/cP3IHIAAAABYktHRBcL1piPAAAAB3RJTUUH5wkSBwYgWO7tNAAAARtJREFUGNMBEAHv/gAAAQIDBAUGBwgHCQoLDA0OAA8QERITFBUWFxgZGhscHR4AHyAhIiIjJCUHJicoKSorLAAtLi8wMC8xMjMXNDU2Lzc4ADk6Ozw8PT4/QEFCQ0RFRkcASElKS0xNTk9QUVJTVEpVVgBXWFlZWltcXV5fYGFiWWNkAGVmZ2hpamtsbW5vcHFyc3QAdXZ3eHl6e3x9fn+AgYKDhACFhoeIiYqLjI2Ijo+QkZKTAJSVlpeYmZqbnJ2en6CeoaIAo6SlpqeoqaqrrK2ur7CxsgCztLW2t7i5F7q7vL2+tb/AAMHCw8TFxscXyMnKxMvDzM0Azs/Q0dLTB9QX1dbX0NjZ2gDb3N3d3N4XF9/g3d3d3eHinyRwGnuYBAsAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDktMThUMDc6MDY6MzIrMDA6MDB2b2K2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA5LTE4VDA3OjA2OjMyKzAwOjAwBzLaCgAAACh0RVh0ZGF0ZTp0aW1lc3RhbXAAMjAyMy0wOS0xOFQwNzowNjozMiswMDowMFAn+9UAAAAASUVORK5CYII=",version:"0.0.11",description:"Plugin nguồn Net Truyen",author:"Tachibana Shin <tachibshin@duck.com>",homepage:"https://github.com/manga-raiku/raiku-plugin-nettruyen",isNSFW:!1,language:"vi",updatedAt:1697029048845});function q(t){return Object.fromEntries(new URLSearchParams(t.slice((t.indexOf("?")>>>0)+1)).entries())}function X(t){const e=t.indexOf("/tim-truyen/")+12;return t.slice(e,t.indexOf("?",e)>>>0).replace(/\/$/,"").replace(/\/$/,"_")}function U(t){var e,n,a;return(a=(n=(e=t.attr("data-src"))!=null?e:t.attr("data-original"))!=null?n:t.attr("data-cdn"))!=null?a:t.attr("src")}function j(t){const e=t.indexOf("/truyen-tranh/")+14;return t.slice(e,t.indexOf("?",e)>>>0).replace(/\/$/,"").replace(/\/$/,"_")}function G(t){const e=t.indexOf("/truyen-tranh/")+14,n=t.slice(e,t.indexOf("/",e)),a=t.slice(e+n.length+1,t.indexOf("/",t.indexOf("/",e+n.length+1)+1)>>>0).replace(/^chap-/i,"").replace(/\//g,"-i");return{comic:n,chap:a}}function H(t,e,n){return t(e.toArray().find(a=>!!t(a).text().trim().startsWith(n))).text().trim().slice(n.length).trim()}function J(t,e,n){const a=U(e.find("img")),r={name:"comic",params:{sourceId:x.id,comic:j(i(e.find("a").attr("href")))}},o=e.find("h3").text().trim(),c=e.find(".message_main p"),s=H(t,c,"Tên khác:"),d=H(t,c,"Thể loại:").split(",").map(h=>h.trim()).filter(Boolean),p=H(t,c,"Tình trạng:"),u=H(t,c,"Tác giả:"),A=e.find(".box_text").text(),I=e.find("h3 + a, .chapter a").toArray().map(h=>{const _=t(h),N=m(_),O=_.next(),D={name:"comic chap",params:L({sourceId:x.id},G(N.path))};return{id:parseInt(_.attr("href").match(/(\d+)\/?$/)[1])+"",route:D,name:S(N.name),updated_at:O.is(".time")&&O.text()?$(O.text(),n):null,views:null}}),[f,g,l]=e.find(".pull-left").text().trim().split(" ").filter(Boolean).map(h=>K(h)),y=t(".icon.icon-hot").length>0?"Hot":null;return{image:a,route:r,name:o,othername:s,tags:d,status:p,author:u,description:A,last_chapters:I,views:f,comments:g,likes:l,label:y}}function V(t,e){var f;const n=parseDom(t),a=n("#ctl00_mainContent_ctl00_divBasicFilter > h1 > strong").text().trim(),r=n("#ctl00_mainContent_ctl00_divDescription").text(),o={type:"Thể loại",select:n("#ctl00_divRight > div > div > ul > li > a").toArray().map(g=>{const l=n(g),y=i(l.attr("href")),h={name:"genre",params:{sourceId:x.id,type:X(y)},query:q(y)},_=l.text();return{route:h,name:_}})},c={type:"Trạng thái",key:"status",items:n("#ctl00_mainContent_ctl00_ulStatus a").toArray().map(g=>{const{name:l,path:y}=m(n(g)),h=new URL(y,"http://localhost").searchParams.get("status");return{name:l,value:h}})},s={type:"Sắp xếp",key:"sort",items:n("#ctl00_mainContent_ctl00_divSort a").toArray().map(g=>{const{name:l,path:y}=m(n(g)),h=new URL(y,"http://localhost").searchParams.get("sort");return{name:l,value:h}})},d=[o,c,s],p=n("#ctl00_divCenter > div.Module.Module-170 .item, .items .item").toArray().map(g=>J(n,n(g),e)),u=parseInt(n("#ctl00_mainContent_ctl01_divPager .active").text().trim()),A=Number.isNaN(u)?1:u,I=u?parseInt((f=new URL(n("#ctl00_mainContent_ctl01_divPager a").last().attr("href"),"http://localhost").searchParams.get("page"))!=null?f:"1"):1;return{name:a,description:r,filters:d,items:p,curPage:A,maxPage:I}}async function Q({get:t},e,n,a){e.endsWith("/")&&(e=e.slice(0,-1));const r=new URL(e,"http://localhost");r.searchParams.set("page",n+"");for(const c in a)r.searchParams.set(c,a[c]+"");const{data:o}=await t({url:`${P}/${r.pathname}?${r.searchParams+""}`,method:void 0,cache:void 0,integrity:void 0,keepalive:void 0,redirect:void 0,referrerPolicy:void 0,window:void 0});return V(o,Date.now())}async function ct({get:t},e){const{data:n}=await t({url:`${P}/Comic/Services/ComicService.asmx/ProcessChapterList?comicId=${e}`});return JSON.parse(n).chapters.map(a=>{const r={name:"comic chap",params:L({sourceId:x.id},G(i(a.url)))};return{id:a.chapterId+"",name:S(a.name),route:r,updated_at:null,views:null}})}function ot(t,e){const n=parseDom(t),a=n("#ctl00_divAlt1 .item").toArray().map(c=>J(n,n(c),e)),r=n("#ctl00_divCenter .item").toArray().map(c=>J(n,n(c),e)),o=n("#topMonth li").toArray().map(c=>{const s=n(c),d=U(s.find("img")),p={name:"comic",params:{sourceId:x.id,comic:i(s.find("a").attr("href"))}},u=s.find("h3").text().trim(),{path:A,name:I}=m(s.find(".chapter a")),f={route:{name:"comic chap",params:L({sourceId:x.id},G(A))},name:S(I),updated_at:K(s.find(".chapter .view").text().trim())};return{image:d,route:p,name:u,last_chapter:f}});return{recommend:a,last_update:r,top:o}}async function st({get:t}){const[e,n]=await Promise.all([t({url:P}).then(a=>ot(a.data,Date.now())),t({url:`${P}/tim-truyen?status=-1&sort=13`}).then(a=>V(a.data,Date.now()))]);return{sliders:n.items.slice(0,7),hot:n.items.slice(7),last_update:e.last_update}}function it(t){const e=parseDom(t);return e("li").toArray().map(n=>{const a=e(n),r={name:"comic",params:{sourceId:x.id,comic:j(i(a.find("a").attr("href")))}},o=a.find("h3").text().trim(),c=U(a.find("img")),s=a.find("h4 i"),d=S(s.first().text()),p=s.length>2?s.eq(1).text().trim():"",u=s.last().text().split(",").map(A=>A.trim()).filter(Boolean);return{route:r,name:o,image:c,last_chapter:d,othername:p,tags:u}})}async function mt({get:t},e,n){const{data:a}=await t({url:`${P}/Comic/Services/SuggestSearch.ashx?q=${encodeURIComponent(e)}&page=${n}`});return it(a)}async function dt({get:t},e,n){const{data:a}=await t({url:`${P}/tim-truyen?keyword=${encodeURIComponent(e)}&page=${n}`});return V(a,Date.now())}function W(t,e,n){var A,I;const a=parseInt(e.attr("id").match(/\d+/)[0]),r=(I=(A=e.find(".member > .progress-bar").attr("style"))==null?void 0:A.match(/width:\s*(\d+)/))==null?void 0:I[1],o={avatar:U(e.find(".avatar img")),name:e.find(".authorname").text().trim(),level:{current:parseInt(e.find(".member > span:eq(0)").attr("data-level")),perNext:r?parseFloat(r):null},chapter:S(e.find(".cmchapter").text().trim())};e.find(".comment-content img").each((f,g)=>{const l=t(g);l.attr("src",U(l))});const c=e.find(".comment-content").html(),s=parseInt(e.find(".vote-up-count").text()),d=parseInt(e.find(".vote-down-count").text()),p=$(e.find("abbr:eq(0)").text(),n),u=e.find(".item.child").toArray().map(f=>W(t,e.find(f),n));return{id:a,author:o,content:c,like:s,dislike:d,created_at:p,repiles:u}}function ut(t,e){var D,k,R,F;const n=parseDom(t),a=n("#item-detail"),r=a.find("h1").text().trim(),o=parseInt((k=(D=t.match(/gOpts\.comicId=(\d+)/))==null?void 0:D[1])!=null?k:""),c=$(a.find("time").text().trim().slice(16,-1),e),s=U(n("#item-detail > div.detail-info > div > div.col-xs-4.col-image > img")),d=a.find(".othername p:not(.name)").text().trim(),p=a.find(".author p:not(.name)").find("a").toArray().map(w=>{const{name:C,path:M}=m(n(w)),T={name:"author",params:{sourceId:x.id,type:""},query:q(M)};return{name:C,route:T}}),u=a.find(".status p:not(.name)").text().trim(),A=a.find(".kind p:not(.name)").find("a").toArray().map(w=>{const{name:C,path:M}=m(n(w)),T={name:"genre",params:{sourceId:x.id,type:X(M)},query:q(M)};return{name:C,route:T}}),I=K(a.find(".kind").next().find("p:not(.name)").text().replace(/\./g,"")),f=a.find("span[itemprop=aggregateRating]"),g={cur:parseFloat(f.find("[itemprop=ratingValue]").text()),max:parseFloat(f.find("[itemprop=bestRating]").text()),count:parseInt(f.find("[itemprop=ratingCount]").text())},l=K(n(".follow b").text()),y=n(".detail-content p").text(),h=n("#nt_listchapter .chapter").toArray().map(w=>{const C=n(w),{path:M,name:T}=m(C.find("a")),yt={name:"comic chap",params:L({sourceId:x.id},G(M))},xt=parseInt(C.find("a").attr("data-id"))+"",It=$(C.next().text(),e)||null,Ct=K(C.next().next().text().trim());return{id:xt,route:yt,name:S(T),updated_at:It,views:Ct}}),_=n("#nt_comments .comment-list .item").toArray().map(w=>W(n,n(w),e)),N=parseInt(n(".comment-count").text()),O=parseInt((F=(R=n("#ctl00_mainContent_divPager > ul > li:nth-child(14) > a").last().attr("href"))==null?void 0:R.slice(1))!=null?F:"1")||1;return{name:r,othername:d,manga_id:o+"",updated_at:c,image:s,author:p,status:u,genres:A,views:I,likes:null,rate:g,follows:l,description:y,chapters:h,comments:_,comments_count:N,comments_pages:O}}async function pt({get:t},e){const{data:n,url:a}=await t({url:`${P}/truyen-tranh/${e}`});if(Y(a))throw new Error("not_found");return ut(n,Date.now())}function lt(t,e){var l,y,h,_,N,O,D,k;const n=parseDom(t),a=n("#ctl00_Head1 > meta:nth-child(12)").attr("content"),r=n("h1").text().split("-").slice(0,-1).join("-").trim(),o={name:"comic",params:{sourceId:x.id,comic:j(m(n("#ctl00_divCenter > div > div:nth-child(1) > div.top > h1 > a")).path)}},c=parseInt((y=(l=t.match(/gOpts\.comicId=(\d+)/))==null?void 0:l[1])!=null?y:"")+"",s=parseInt((_=(h=t.match(/gOpts\.chapterId=(\d+)/))==null?void 0:h[1])!=null?_:"")+"",d=(N=t.match(/gOpts\.cdn="([^"]+)"/))==null?void 0:N[1],p=(O=t.match(/gOpts\.cdn2="([^"]+)"/))==null?void 0:O[1],u=$(n("#ctl00_divCenter > div > div:nth-child(1) > div.top > i").text().trim().slice(16,-1),e),A=n(".reading-detail img").toArray().map(R=>{const F=n(R),w=F.attr("src"),C=F.attr("data-original"),M=F.attr("data-cdn");return{src:w.includes("/logos/logo-nettruyen.png")?C:w,original:C,cdn:M}}),I=n("#nt_comments .comment-list .item").toArray().map(R=>W(n,n(R),e)),f=parseInt(n(".comment-count").text()),g=parseInt((k=(D=n("#ctl00_mainContent_divPager > ul > li:nth-child(14) > a").last().attr("href"))==null?void 0:D.slice(1))!=null?k:"1")||1;return{name:r,image:a,manga_id:c,path_manga:o,ep_id:s,updated_at:u,pages:A,cdn:d,cdn2:p,comments:I,comments_count:f,comments_pages:g}}async function ht({get:t},e,n){const{data:a,url:r}=await t({url:`${P}/truyen-tranh/${e}`});if(Y(r))throw new Error("not_found");const o=await lt(a,Date.now());if(!n){const{data:c}=await t({url:`${P}/Comic/Services/ComicService.asmx/ProcessChapterList?comicId=${o.manga_id}`});return et(L({},o),{chapters:JSON.parse(c).chapters.map(s=>{const d={name:"comic chap",params:L({sourceId:x.id},G(s.url))};return{id:s.chapterId,name:S(s.name),route:d,updated_at:null}})})}return o}function ft(t,e){const n=parseDom(t);return n(".item").toArray().map(a=>W(n,n(a),e))}async function gt({get:t},e,n,a=-1,r=0,o,c){const{data:s}=await t({url:`https://www.nettruyenmax.com/Comic/Services/CommentService.asmx/List?comicId=${e}&orderBy=${n?5:0}&chapterId=${a}&parentId=${r}&pageNumber=${o}&token=${c}`}),{commentCount:d,pager:p,response:u}=JSON.parse(s);return{comments_count:parseInt(d),comments_pages:parseInt(p.slice(p.indexOf('a href="#')>>>0,2)),comments:await ft(u,Date.now())}}const Z=[{value:"ngay",match:"/tim-truyen?status=-1&sort=13",name:{"vi-VN":"Ngày","en-US":"Date"}},{value:"tuan",match:"/tim-truyen?status=-1&sort=12",name:{"vi-VN":"Tuần","en-US":"Week"}},{value:"thang",match:"/tim-truyen?status=-1&sort=11",name:{"vi-VN":"Tháng","en-US":"Month"}}],b={referer:"https://www.nettruyenmax.com"},At=[{name:"Server 1",has:()=>!0,parse:({pages:t})=>t.map(e=>B(e.src,b))},{name:"Server 2",has:({pages:t})=>t[0].original!==null&&t[0].original!==t[0].src,parse({pages:t}){return t.map(e=>{var n;return((n=e.original)==null?void 0:n.indexOf("focus-opensocial.googleusercontent"))!==-1?B(decodeURIComponent(e.original.split("&url",2)[1]),b):B(`https://images2-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&gadget=a&no_expand=1&resize_h=0&rewriteMime=image%2F*&url=${encodeURIComponent(e.original)}`,b)})}},{name:"Server 3",has:t=>t.cdn!==null,parse:({pages:t})=>t.map(e=>B(e.cdn,b))},{name:"Server 4",has:({pages:t,cdn:e,cdn2:n})=>t[0].cdn!==null&&!!e&&!!n,parse:({pages:t,cdn:e,cdn2:n})=>t.map(a=>B(a.cdn.replace(e,n),b))}];class vt{constructor(e,n){E(this,"Rankings",Z);E(this,"Servers",At);E(this,"get");E(this,"post");this.get=e,this.post=n}async index(){return st(this)}async getComic(e){return pt(this,e)}async getComicChapter(e,n,a){const r=n.lastIndexOf("-i")>>>0;return ht(this,e+"/"+n.slice(0,r)+"/"+n.slice(r+2),a)}async getComicComments(e,n,a=-1,r=0,o,c){return gt(this,e,n,a,r,o,c)}async getListChapters(e){return ct(this,e)}async searchQuickly(e,n){return mt(this,e,n)}async search(e,n){return dt(this,e,n)}async getRanking(e,n,a){var o;const r=(o=Z.find(c=>c.value===e))==null?void 0:o.match;if(!r)throw new Error("not_found");return Q(this,r,n,a)}async getCategory(e,n,a){return Q(this,`/tim-truyen/${e}`,n,a)}}at(vt)})();
